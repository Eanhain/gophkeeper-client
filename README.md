# GophKeeper — Клиент (TUI)

Терминальный клиент для менеджера секретов GophKeeper.  
Предоставляет TUI-интерфейс (Bubble Tea) для управления паролями, заметками, файлами и банковскими картами.

## Возможности

- Регистрация и авторизация (JWT)
- CRUD для 4 типов секретов (логины/пароли, текст, бинарные данные, карты)
- Локальный зашифрованный кеш (AES-256-GCM) — минимизирует запросы к серверу
- Полное шифрование трафика клиент-сервер (AES-256-GCM)
- Настройка через `.env` и CLI-флаги

## Архитектура

```
cmd/main.go              — точка входа
configs/                 — загрузка конфигурации (.env + CLI флаги)
contracts/
  request/               — DTO запросов к серверу
  response/              — DTO ответов от сервера
internal/
  usecase/               — бизнес-логика (координация клиента и кеша)
  clientConn/            — HTTP-клиент (Fiber) с шифрованием тел запросов
  crypto/                — AES-256-GCM шифрование/дешифрование
  storage/               — зашифрованный файловый кеш
  tui/                   — терминальный интерфейс (Bubble Tea)
  entity/                — доменные модели
```

## Требования

- Go 1.25+
- Запущенный сервер GophKeeper (см. `../gophkeeper/README.md`)

## Быстрый старт

### 1. Убедиться, что сервер запущен

```bash
cd ../gophkeeper
go run ./cmd/app
```

### 2. Настроить .env

Файл `.env` уже в корне проекта. При необходимости поменять:

```env
APP_NAME=gophkeeper-client
APP_VERSION=1.0.0
HTTP_PORT=8080
HTTP_HOST=127.0.0.1
LOG_LEVEL=debug
CRYPTO_KEY=change-me
```

**Важно:** `CRYPTO_KEY` должен совпадать с серверным.

### 3. Запустить клиент

```bash
go run ./cmd/main.go
```

## CLI-флаги

Флаги переопределяют значения из `.env`:

```bash
go run ./cmd/main.go --host 192.168.1.100 --port 9090 --crypto-key my-secret-key --log info
```

| Флаг           | Описание                   | По умолчанию  |
|----------------|----------------------------|---------------|
| `--host`       | Адрес сервера              | `127.0.0.1`   |
| `--port`       | Порт сервера               | `8080`        |
| `--crypto-key` | Ключ шифрования            | `change-me`   |
| `--log`        | Уровень логирования        | `debug`       |
| `-v`           | Показать версию и выйти    | —             |
| `-h`           | Показать справку            | —             |

## Управление в TUI

### Экран авторизации

| Клавиша     | Действие                        |
|-------------|---------------------------------|
| `Tab`       | Переключение между полями       |
| `Enter`     | Отправить форму                 |
| `Ctrl+R`    | Переключить режим Login/Register|
| `Ctrl+C`    | Выход                           |

### Главное меню

| Клавиша     | Действие                        |
|-------------|---------------------------------|
| `↑` / `↓`  | Навигация по пунктам            |
| `Enter`     | Выбрать пункт                   |
| `q`         | Выход                           |

### Форма создания/удаления секрета

| Клавиша       | Действие                      |
|---------------|-------------------------------|
| `Tab`/`Shift+Tab` | Переключение между полями |
| `Enter`       | Отправить                     |
| `Esc`         | Назад в меню                  |

### Просмотр секретов

| Клавиша     | Действие                        |
|-------------|---------------------------------|
| `Esc`       | Назад в меню                    |

## Как работает кеш

- При первом запросе секретов данные загружаются с сервера и сохраняются в зашифрованный файл `.gophkeeper_cache.enc`.
- Повторные запросы читают из кеша без обращения к серверу.
- Любая операция записи/удаления **сбрасывает кеш** — следующий запрос снова пойдёт на сервер.
- Кнопка **"Reset Cache"** в меню принудительно очищает кеш (полезно, если секреты менялись из другого клиента).

## Шифрование

Всё взаимодействие клиент-сервер зашифровано:

1. Клиент сериализует JSON.
2. Шифрует AES-256-GCM (ключ = `SHA-256(CRYPTO_KEY)`).
3. Отправляет `nonce (12 байт) || ciphertext` как `application/octet-stream`.
4. Сервер расшифровывает, обрабатывает, шифрует ответ тем же способом.
5. Клиент расшифровывает ответ и показывает в TUI.

Локальный кеш шифруется тем же ключом.

## Тесты

```bash
go test ./...
```

Покрытие:
- `internal/usecase` — 100%
- `internal/crypto` — 91%+
- `internal/storage` — 91%+
